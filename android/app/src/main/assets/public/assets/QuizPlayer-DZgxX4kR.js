import{b as G,u as U,a as $,r as a,j as e}from"./index-fqoWOEOd.js";import{A as C}from"./arrow-left-Co68oQub.js";import{C as V}from"./clock-CZa3_aXS.js";import{c as E}from"./createLucideIcon-CvVNInVQ.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],K=E("arrow-right",H);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ee=E("circle-check",Z);function ce(){var z;const{id:A,idx:I}=G(),t=Number(I),x=U(),{decks:M}=$(),n=M.find(s=>String(s.id)===A),[o,b]=a.useState(""),[l,m]=a.useState(null),[P,R]=a.useState(0),[y,f]=a.useState(0),p=a.useRef(null),[j,v]=a.useState(!1),[T,w]=a.useState(!1),[O,Q]=a.useState(""),{userXP:se,setUserXP:X}=$(),N=a.useRef(null),_=(z=window==null?void 0:window.Capacitor)==null?void 0:z.isNativePlatform(),B="https://brillian-flashcard-backend.onrender.com";if(a.useEffect(()=>{var s;(s=p.current)==null||s.focus(),b(""),m(null)},[t]),a.useEffect(()=>{const s=setInterval(()=>R(r=>r+1),1e3);return()=>clearInterval(s)},[]),a.useEffect(()=>{f(0);const s=setInterval(()=>f(r=>r+1),1e3);return()=>clearInterval(s)},[t]),!n||!Array.isArray(n.quiz)||!n.quiz[t])return e.jsx("div",{className:"p-8",children:"Question not found."});const k=n.quiz.length,J=()=>x(`/deck/${n.id}/quiz/${t+1}`),L=()=>x(`/deck/${n.id}/quiz/${t-1}`),W=()=>x(`/deck/${n.id}`),S=o.trim().length===0,Y=s=>{const r=String(Math.floor(s/60)).padStart(2,"0"),d=String(s%60).padStart(2,"0");return`${r}:${d}`},D=s=>s.toFixed(2),F=async()=>{var r;if(S){(r=p.current)==null||r.focus();return}v(!0);const s={question:n.quiz[t].question,answer:n.quiz[t].answer,key_points:n.quiz[t].key_points,studentAnswer:o};try{const g=await(await fetch(`${B}/api/grade`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();m(g);const q=Math.max(5,Math.round(g.percent/10));X(u=>u+q),Q(`Good job! +${q} XP`),w(!0),setTimeout(()=>w(!1),2e3),setTimeout(()=>{var u;(u=N.current)==null||u.scrollIntoView({behavior:"smooth",block:"center"})},50);const h=`quiz-${n.id}-${t}-best`,c=JSON.parse(localStorage.getItem(h)||"null"),i={...g,answer:o.trim(),time:y};(!c||i.percent>(c.percent??0)||i.percent===c.percent&&i.time<(c.time??1/0))&&localStorage.setItem(h,JSON.stringify(i)),(!c||i.percent>(c.percent??0))&&localStorage.setItem(h,JSON.stringify(i))}catch(d){console.error("grading failed",d),m({percent:0,positive:[],negative:[],suggestion:"An Error Occured, Please Try Again"})}finally{v(!1),f(0)}};return e.jsxs("div",{className:"flex flex-col items-center w-full min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"flex justify-between items-center w-full max-w-6xl px-4 py-6",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-blue-600",children:[e.jsx(C,{size:20,color:"blue"}),"Exit"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Q ",t+1," / ",k," | Elapsed Time: ",Y(P)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-lg font-semibold",children:[e.jsx(V,{size:22}),D(y)," sec"]}),e.jsxs("div",{className:"flex flex-col max-w-3xl w-full mx-auto p-6 gap-6",children:[e.jsx("h2",{className:`text-xl lg:text-2xl font-semibold text-blue-700
                    flex items-start`,children:`Q${t+1} ‚Äî ${n.quiz[t].question}`}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{ref:p,value:o,onChange:s=>b(s.target.value),placeholder:"‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‚Ä¶",className:`w-full h-30 md:h-40 lg:h-40 border rounded-lg p-4
                   focus:ring-2 focus:ring-blue-500 outline-none
                   resize-none overflow-y-auto text-black`})}),e.jsxs("div",{className:`flex flex-col-reverse sm:flex-row
                   items-stretch sm:items-center justify-between gap-3`,children:[e.jsxs("div",{className:"flex ",children:[e.jsxs("button",{onClick:L,disabled:t===0,className:`inline-flex items-center justify-center gap-2 px-4 py-2
                     rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200
                     disabled:opacity-40`,children:[e.jsx(C,{size:18})," Back"]}),e.jsxs("button",{onClick:J,disabled:t+1>=k,className:`inline-flex items-center justify-center px-4 py-2 rounded-md bg-yellow-50 text-yellow-700
                       hover:bg-yellow-100 disabled:opacity-40`,children:["Next ",e.jsx(K,{size:18})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:F,disabled:j||S,className:`inline-flex items-center gap-2 px-4 py-2 rounded-md
                       bg-blue-600 text-white hover:bg-blue-700
                       active:scale-[.97] transition disabled:opacity-50`,children:[e.jsx(ee,{size:18})," Check Answers"]})})]}),l&&e.jsxs("div",{ref:N,className:`mt-4 p-4 rounded-lg bg-green-50 border border-green-200
               max-h-[25vh] overflow-y-auto`,children:[e.jsxs("p",{className:"font-semibold text-green-700",children:["Your Score: ",l.percent,"%"]}),e.jsxs("p",{className:"text-green-700",children:["‚úÖ What You Did Well: ",l.positive.join(", ")]}),e.jsxs("p",{className:"text-red-600",children:["‚ùå What You Missed: ",l.negative.join(", ")]}),e.jsxs("p",{className:"text-blue-700",children:["üí° Suggestions: ",l.suggestion]})]})]}),j&&e.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center
                  bg-black/50 backdrop-blur-sm`,children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6 bg-white rounded shadow",children:[e.jsx("div",{className:`w-8 h-8 border-4 border-blue-600 border-t-transparent
                      animate-spin rounded-full`}),e.jsx("p",{className:"text-black",children:"Evaluating your answer‚Ä¶"})]})}),T&&e.jsx("div",{className:"xp-message",children:O})]})}export{ce as default};
